schema: '2.0'
stages:
  download_benchmark_data:
    cmd: python src/mctm/data/benchmark.py | tee datasets/benchmark_stats
    outs:
    - path: datasets/benchmark_stats
      hash: md5
      md5: d2c8e4eeea4465d0bd5e5473f8d6a93a
      size: 9349
    - path: datasets/bsds300/
      hash: md5
      md5: e4ab795c846604419827e750c741c2ce.dir
      size: 327602144
      nfiles: 1
    - path: datasets/data.tar.gz
      hash: md5
      md5: 9b9c9b0375315ad270eba4ce80c093ab
      size: 856664546
    - path: datasets/hepmass/
      hash: md5
      md5: 5e24c498e022d4c8b79714a6065882cf.dir
      size: 750085192
      nfiles: 2
    - path: datasets/miniboone/
      hash: md5
      md5: 5cf3ec51bb664978790c9a45a3531e98.dir
      size: 12551952
      nfiles: 1
    - path: datasets/power/
      hash: md5
      md5: 885e2dbe66f0670d26e959e74be98025.dir
      size: 131154000
      nfiles: 1
  unconditional_benchmark@elementwise_flow-hepmass:
    cmd: python scripts/train_benchmark.py --log-level info --log-file results/unconditional_benchmark_elementwise_flow_hepmass/train.log
      --experiment-name unconditional-benchmark-hepmass unconditional_benchmark@elementwise_flow-hepmass
      elementwise_flow hepmass results/unconditional_benchmark_elementwise_flow_hepmass
      --test-mode=true
    deps:
    - path: datasets/hepmass
      hash: md5
      md5: 5e24c498e022d4c8b79714a6065882cf.dir
      size: 750085192
      nfiles: 2
    - path: pyproject.toml
      hash: md5
      md5: f04546362686cf891a3c1b7df83d1e0b
      size: 1104
    - path: scripts/train.py
      hash: md5
      md5: 916524801990bc4d596d19e635883808
      size: 5431
    - path: src/mctm
      hash: md5
      md5: 1c4d557c6e5dc3341f257a44a062eedb.dir
      size: 80242
      nfiles: 14
    params:
      params.yaml:
        benchmark_datasets.hepmass*: {}
        log-level: info
        seed: 1
        unconditional_benchmark_distributions.elementwise_flow.hepmass*:
          distribution_kwds:
            bijector_name: bernstein_poly
            order: 100
            low: -3
            high: 3
            smooth_bounds: true
            allow_flexible_bounds: true
            shift: false
            scale: false
          parameter_kwds:
            conditional: false
            dtype: float32
          fit_kwds:
            epochs: 10000
            validation_split:
            batch_size: 32
            lr_patience: 10
            reduce_lr_on_plateau: true
            early_stopping: true
            verbose: true
            monitor: val_loss
            learning_rate: 0.01
            lr_reduction_factor: 0.1
    outs:
    - path: results/unconditional_benchmark_elementwise_flow_hepmass/mcp
      hash: md5
      md5: 0530413b431d39f8b8051900d4761a31.dir
      size: 26864
      nfiles: 3
    - path: results/unconditional_benchmark_elementwise_flow_hepmass/metrics.yaml
      hash: md5
      md5: 4df4f4661d0b0cbac7fa985d5bfffb5c
      size: 54
    - path: results/unconditional_benchmark_elementwise_flow_hepmass/train.log
      hash: md5
      md5: 9cbe5eef18773d7720417a63e0d6f058
      size: 3589
  unconditional_benchmark@elementwise_flow-miniboone:
    cmd: python scripts/train_benchmark.py --log-level info --log-file results/unconditional_benchmark_elementwise_flow_miniboone/train.log
      --experiment-name unconditional-benchmark-miniboone unconditional_benchmark@elementwise_flow-miniboone
      elementwise_flow miniboone results/unconditional_benchmark_elementwise_flow_miniboone
      --test-mode=true
    deps:
    - path: datasets/miniboone
      hash: md5
      md5: 5cf3ec51bb664978790c9a45a3531e98.dir
      size: 12551952
      nfiles: 1
    - path: pyproject.toml
      hash: md5
      md5: f04546362686cf891a3c1b7df83d1e0b
      size: 1104
    - path: scripts/train.py
      hash: md5
      md5: 916524801990bc4d596d19e635883808
      size: 5431
    - path: src/mctm
      hash: md5
      md5: 1c4d557c6e5dc3341f257a44a062eedb.dir
      size: 80242
      nfiles: 14
    params:
      params.yaml:
        benchmark_datasets.miniboone*: {}
        log-level: info
        seed: 1
        unconditional_benchmark_distributions.elementwise_flow.miniboone*:
          distribution_kwds:
            bijector_name: bernstein_poly
            order: 100
            low: -3
            high: 3
            smooth_bounds: true
            allow_flexible_bounds: true
            shift: false
            scale: false
          parameter_kwds:
            conditional: false
            dtype: float32
          fit_kwds:
            epochs: 10000
            validation_split:
            batch_size: 373
            lr_patience: 7
            reduce_lr_on_plateau: true
            early_stopping: true
            verbose: true
            monitor: val_loss
            learning_rate: 0.004919703071742458
            lr_reduction_factor: 0.1
    outs:
    - path: results/unconditional_benchmark_elementwise_flow_miniboone/mcp
      hash: md5
      md5: 7c751722e856667aacc28665a84c360f.dir
      size: 53273
      nfiles: 3
    - path: results/unconditional_benchmark_elementwise_flow_miniboone/metrics.yaml
      hash: md5
      md5: e9e0674449005f42d3a9e1c1ac70de6b
      size: 52
    - path: results/unconditional_benchmark_elementwise_flow_miniboone/train.log
      hash: md5
      md5: ca49790bb830346899f7f2de043c96f8
      size: 3629
