log-level: info
seed: 1
textwidth: 487.8225
testmode: false

datasets:
  moons:
    n_samples: 2000
    noise: 0.05
    scale: true
  circles:
    n_samples: 2000
    noise: 0.05
    factor: 0.5
    scale: true

benchmark_datasets:
  bsds300:
    scale:
    - 0.41659998893737793
    - 0.42329999804496765
    - 0.43380001187324524
    - 0.42239999771118164
    - 0.4309999942779541
    - 0.4415999948978424
    - 0.4198000133037567
    - 0.39969998598098755
    - 0.4196999967098236
    - 0.40849998593330383
    - 0.46160000562667847
    - 0.46709999442100525
    - 0.43220001459121704
    - 0.45559999346733093
    - 0.4341999888420105
    - 0.42320001125335693
    - 0.41110000014305115
    - 0.43639999628067017
    - 0.4542999863624573
    - 0.42320001125335693
    - 0.46650001406669617
    - 0.4505000114440918
    - 0.4431000053882599
    - 0.4269999861717224
    - 0.4334999918937683
    - 0.44209998846054077
    - 0.4724000096321106
    - 0.462799996137619
    - 0.45980000495910645
    - 0.4657999873161316
    - 0.43220001459121704
    - 0.43149998784065247
    - 0.42800000309944153
    - 0.435699999332428
    - 0.4577000141143799
    - 0.439300000667572
    - 0.41620001196861267
    - 0.4542999863624573
    - 0.44850000739097595
    - 0.40540000796318054
    - 0.4350000023841858
    - 0.44200000166893005
    - 0.44179999828338623
    - 0.4374000132083893
    - 0.4577000141143799
    - 0.46219998598098755
    - 0.45239999890327454
    - 0.4104999899864197
    - 0.4171999990940094
    - 0.4316999912261963
    - 0.43140000104904175
    - 0.4837999939918518
    - 0.4465999901294708
    - 0.43320000171661377
    - 0.4203999936580658
    - 0.4255000054836273
    - 0.4072999954223633
    - 0.41110000014305115
    - 0.3986000120639801
    - 0.43700000643730164
    - 0.41190001368522644
    - 0.4058000147342682
    - 0.41339999437332153
    shift:
    - 1.0306999683380127
    - 1.01010000705719
    - 0.9848999977111816
    - 0.9800999760627747
    - 0.9926000237464905
    - 0.9603000283241272
    - 1.0347000360488892
    - 1.0843000411987305
    - 1.0469000339508057
    - 1.003999948501587
    - 0.9032999873161316
    - 0.9136999845504761
    - 0.9534000158309937
    - 0.9480999708175659
    - 0.9422000050544739
    - 1.0094000101089478
    - 0.972000002861023
    - 0.8550000190734863
    - 0.9434999823570251
    - 1.0500999689102173
    - 0.909500002861023
    - 0.9544000029563904
    - 0.9394999742507935
    - 1.0041999816894531
    - 0.917900025844574
    - 0.8917999863624573
    - 0.902400016784668
    - 0.9350000023841858
    - 0.9391999840736389
    - 0.8554999828338623
    - 1.0074000358581543
    - 0.9652000069618225
    - 0.9664000272750854
    - 0.935699999332428
    - 0.9135000109672546
    - 1.0443999767303467
    - 1.0032000541687012
    - 0.9236999750137329
    - 0.9197999835014343
    - 0.9959999918937683
    - 0.9128999710083008
    - 0.9452000260353088
    - 0.9740999937057495
    - 1.0039000511169434
    - 0.9194999933242798
    - 0.8916000127792358
    - 0.9072999954223633
    - 1.0535999536514282
    - 0.9842000007629395
    - 0.9395999908447266
    - 0.878600001335144
    - 0.8270999789237976
    - 0.9574999809265137
    - 0.9839000105857849
    - 0.9797000288963318
    - 1.001099944114685
    - 1.0077999830245972
    - 1.0020999908447266
    - 1.0638999938964844
    - 0.9480999708175659
    - 1.030500054359436
    - 1.0365999937057495
    - 1.0033999681472778
  hepmass:
    scale:
    - 0.1239
    - 0.1383
    - 0.2021
    - 0.0648
    - 0.2022
    - 0.0709
    - 0.1148
    - 0.2022
    - 0.0806
    - 0.1278
    - 0.202
    - 0.0928
    - 0.1388
    - 0.2022
    - 0.1109
    - 0.1521
    - 0.202
    - 0.0782
    - 0.0645
    - 0.0441
    - 0.1059
    shift:
    - 2.7185
    - 3.0382
    - 2.0813
    - 9.6636
    - 2.0774
    - 6.2201
    - 3.6592
    - 2.0762
    - 4.9618
    - 3.2846
    - 2.0777
    - 3.7834
    - 3.0268
    - 2.0786
    - 2.4003
    - 2.7624
    - 2.0787
    - 3.6851
    - 4.0974
    - 7.1135
    - 3.0255
  miniboone:
    scale:
    - 0.0723
    - 0.0744
    - 0.0478
    - 0.0514
    - 0.0561
    - 0.078
    - 0.078
    - 0.0684
    - 0.0641
    - 0.0423
    - 0.1552
    - 0.1747
    - 0.0629
    - 0.1003
    - 0.1045
    - 0.0219
    - 0.0592
    - 0.0544
    - 0.0292
    - 0.0576
    - 0.0458
    - 0.0388
    - 0.0251
    - 0.0594
    - 0.0479
    - 0.0497
    - 0.0614
    - 0.0587
    - 0.0653
    - 0.1392
    - 0.0819
    - 0.0687
    - 0.0752
    - 0.0432
    - 0.0482
    - 0.0886
    - 0.04
    - 0.037
    - 0.0354
    - 0.0281
    - 0.062
    - 0.0263
    - 0.0639
    shift:
    - 2.9376
    - 1.4235
    - 0.5713
    - 4.771
    - 1.78
    - 3.8432
    - 7.8259
    - 5.3501
    - 3.7939
    - 7.5388
    - 1.6129
    - 3.7085
    - 2.2177
    - 1.7269
    - 1.7056
    - 0.7144
    - 4.834
    - 7.6821
    - 13.2659
    - 8.0219
    - 2.7208
    - 20.5045
    - 28.1966
    - 3.458
    - 4.2776
    - 6.5134
    - 2.667
    - 8.4113
    - 1.7045
    - 4.3264
    - 4.0127
    - 2.9532
    - 6.6139
    - 4.4178
    - 3.8924
    - 3.8296
    - 13.6618
    - 2.2742
    - 2.0128
    - 25.2117
    - 2.2119
    - 8.4507
    - 6.3555
  power:
    scale:
    - 0.067
    - 0.0733
    - 0.0484
    - 0.0505
    - 0.1847
    - 0.2022
    shift:
    - 1.1529
    - 6.5351
    - 0.316
    - 0.3703
    - 0.9888
    - 2.0778

unconditional_distributions:
  bernstein_flow:
    moons:
      distribution_kwds: &distribution_kwds
        order: 50
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
        clip_to_bernstein_domain: false
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 1024
        learning_rate: 0.05
        lr_patience: 100
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        order: 80
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 512
        learning_rate: 0.005
        lr_patience: 100
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss

  multivariate_bernstein_flow:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 512
        learning_rate: 0.005
        lr_patience: 100
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 1024
        learning_rate: 0.005
        lr_patience: 100
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss

  multivariate_normal:
    moons:
      distribution_kwds: {}
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 512
        learning_rate: 0.05
        lr_patience: 1000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds: {}
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 512
        learning_rate: 0.05
        lr_patience: 1000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss

  masked_autoregressive_bernstein_flow:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        - 16
        activation: relu
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 1024
        learning_rate: 0.05
        lr_patience: 100
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        activation: relu
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 1024
        learning_rate: 0.01
        lr_patience: 1000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss

  coupling_bernstein_flow:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        coupling_layers: 2
        order: 50
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        activation: relu
        batch_norm: false
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 512
        learning_rate: 0.001
        lr_patience: 100
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        coupling_layers: 2
        order: 50
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        activation: relu
        batch_norm: false
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 512
        learning_rate: 0.001
        lr_patience: 100
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss

unconditional_benchmark_distributions:
  bernstein_flow:
    power:
      distribution_kwds:
        <<: *distribution_kwds
        order: 100
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        epochs: 10000
        batch_size: 32
        learning_rate: 0.01
        lr_patience: 10
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    hepmass:
      distribution_kwds:
        <<: *distribution_kwds
        order: 100
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        epochs: 10000
        batch_size: 32
        learning_rate: 0.01
        lr_patience: 10
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    miniboone:
      distribution_kwds:
        <<: *distribution_kwds
        order: 100
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        epochs: 10000
        batch_size: 32
        learning_rate: 0.01
        lr_patience: 10
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    bsds300:
      distribution_kwds:
        <<: *distribution_kwds
        order: 100
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        epochs: 10000
        batch_size: 32
        learning_rate: 0.01
        lr_patience: 10
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss

  # multivariate_bernstein_flow:
  #   power:
  #     distribution_kwds: *distribution_kwds
  #     parameter_kwds:
  #       conditional: false
  #       dtype: float32
  #     fit_kwds:
  #       epochs: 10000
  #       validation_split: 0.1
  #       batch_size: 512
  #       learning_rate: 0.01
  #       lr_patience: 50
  #       reduce_lr_on_plateau: true
  #       early_stopping: true
  #       verbose: true
  #       monitor: val_loss
  #   hepmass:
  #     distribution_kwds: *distribution_kwds
  #     parameter_kwds:
  #       conditional: false
  #       dtype: float32
  #     fit_kwds:
  #       epochs: 10000
  #       validation_split: 0.1
  #       batch_size: 512
  #       learning_rate: 0.01
  #       lr_patience: 50
  #       reduce_lr_on_plateau: true
  #       early_stopping: true
  #       verbose: true
  #       monitor: val_loss
  #   miniboone:
  #     distribution_kwds: *distribution_kwds
  #     parameter_kwds:
  #       conditional: false
  #       dtype: float32
  #     fit_kwds:
  #       epochs: 10000
  #       validation_split: 0.1
  #       batch_size: 512
  #       learning_rate: 0.01
  #       lr_patience: 50
  #       reduce_lr_on_plateau: true
  #       early_stopping: true
  #       verbose: true
  #       monitor: val_loss
  #   bsds300:
  #     distribution_kwds: *distribution_kwds
  #     parameter_kwds:
  #       conditional: false
  #       dtype: float32
  #     fit_kwds:
  #       epochs: 10000
  #       validation_split: 0.1
  #       batch_size: 512
  #       learning_rate: 0.01
  #       lr_patience: 50
  #       reduce_lr_on_plateau: true
  #       early_stopping: true
  #       verbose: true
  #       monitor: val_loss

  masked_autoregressive_bernstein_flow:
    power:
      distribution_kwds: &benchmark_distribution_kwds
        <<: *distribution_kwds
        order: 100
        # base_distribution_kwds:
        #   distribution_type: kumaraswamy
        #   concentration1: 2
        #   concentration0: 5
        # low: 0.001
        # high: 0.999
        # smooth_bounds: true
        # allow_flexible_bounds: false
      parameter_kwds:
        hidden_units:
        - 64
        - 64
        - 64
        activation: elu
        kernel_initializer: he_normal
      fit_kwds:
        epochs: 10000
        batch_size: 32
        learning_rate: 0.01
        lr_patience: 10
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    hepmass:
      distribution_kwds: *benchmark_distribution_kwds
      parameter_kwds:
        hidden_units:
        - 64
        - 64
        - 64
        activation: elu
        kernel_initializer: he_normal
      fit_kwds:
        epochs: 10000
        batch_size: 32
        learning_rate: 0.01
        lr_patience: 10
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    bsds300:
      distribution_kwds: *benchmark_distribution_kwds
      parameter_kwds:
        hidden_units:
        - 128
        - 128
        - 128
        activation: relu
      fit_kwds:
        epochs: 10000
        batch_size: 512
        learning_rate: 0.01
        lr_patience: 25
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    miniboone:
      distribution_kwds: *benchmark_distribution_kwds
      parameter_kwds:
        hidden_units:
        - 64
        - 64
        - 64
        activation: elu
        kernel_initializer: he_normal
      fit_kwds:
        epochs: 10000
        batch_size: 32
        learning_rate: 0.01
        lr_patience: 10
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss

conditional_distributions:
  bernstein_flow:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
      parameter_kwds:
        conditional: true
        activation: relu
        batch_norm: true
        hidden_units:
        - 16
        - 16
        input_shape: 1
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 1024
        learning_rate: 0.01
        lr_patience: 1000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
      parameter_kwds:
        conditional: true
        activation: relu
        batch_norm: true
        hidden_units:
        - 16
        - 16
        input_shape: 1
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 512
        learning_rate: 0.05
        lr_patience: 1000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss

  multivariate_bernstein_flow:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
      parameter_kwds:
        conditional: true
        activation: relu
        batch_norm: true
        hidden_units:
        - 16
        - 16
        input_shape: 1
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 1024
        learning_rate: 0.01
        lr_patience: 1000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
      parameter_kwds:
        conditional: true
        activation: relu
        batch_norm: true
        hidden_units:
        - 16
        - 16
        input_shape: 1
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 1024
        learning_rate: 0.005
        lr_patience: 1000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss

  multivariate_normal:
    moons:
      distribution_kwds: {}
      parameter_kwds:
        conditional: true
        activation: relu
        batch_norm: true
        hidden_units:
        - 16
        - 16
        input_shape: 1
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 512
        learning_rate: 0.05
        lr_patience: 100
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds: {}
      parameter_kwds:
        conditional: true
        activation: relu
        batch_norm: true
        hidden_units:
        - 16
        - 16
        input_shape: 1
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 1024
        learning_rate: 0.05
        lr_patience: 1000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss

  masked_autoregressive_bernstein_flow:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        - 16
        activation: relu
        conditional: True,
        # conditional_input_layers='first_layer',
        conditional_event_shape: 1
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 1024
        learning_rate: 0.01
        lr_patience: 1000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        - 16
        activation: relu
        conditional: True,
        # conditional_input_layers='first_layer',
        conditional_event_shape: 1
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 1024
        learning_rate: 0.05
        lr_patience: 1000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss

  coupling_bernstein_flow:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        coupling_layers: 2
        order: 80
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        - 16
        activation: relu
        batch_norm: false,
        conditional: True,
        conditional_event_shape: 1
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 1024
        learning_rate: 0.01
        lr_patience: 100
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        coupling_layers: 2
        order: 50
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        activation: relu
        batch_norm: false,
        conditional: True,
        conditional_event_shape: 1
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 512
        learning_rate: 0.01
        lr_patience: 100
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss

unconditional_hybrid_distributions:
  masked_autoregressive_bernstein_flow_first_dim_masked:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        order: 100
        low: 0
        high: 1
      freeze_base_model: false
      base_checkpoint_path: false
      parameter_kwds:
        made_kwds:
          hidden_units: []
          activation: relu
        x0_kwds:
          hidden_units:
          - 16
          - 16
          activation: relu
          batch_norm: false
          kernel_initializer: glorot_uniform
          bias_initializer: zeros
      base_distribution: bernstein_flow
      base_distribution_kwds: *distribution_kwds
      base_parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 512
        learning_rate: 0.01
        lr_patience: 500
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        order: 100
        low: 0
        high: 1
      freeze_base_model: false
      base_checkpoint_path: false
      parameter_kwds:
        made_kwds:
          hidden_units: []
          activation: relu
        x0_kwds:
          hidden_units:
          - 16
          - 16
          activation: relu
          batch_norm: false
          kernel_initializer: glorot_uniform
          bias_initializer: zeros
      base_distribution: bernstein_flow
      base_distribution_kwds: *distribution_kwds
      base_parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 512
        learning_rate: 0.01
        lr_patience: 500
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss

  coupling_bernstein_flow:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        coupling_layers: 1
        order: 80
        low: 0
        high: 1
      freeze_base_model: false
      base_checkpoint_path: false
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        activation: relu
        batch_norm: false
      base_distribution: bernstein_flow
      base_distribution_kwds: *distribution_kwds
      base_parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 512
        learning_rate: 0.05
        lr_patience: 1000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        coupling_layers: 1
        order: 80
        low: 0
        high: 1
      freeze_base_model: false
      base_checkpoint_path: false
      parameter_kwds:
        hidden_units:
        - 512
        - 512
        activation: relu
        batch_norm: false
      base_distribution: bernstein_flow
      base_distribution_kwds: *distribution_kwds
      base_parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 1024
        learning_rate: 0.005
        lr_patience: 1000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss

unconditional_hybrid_pre_trained_distributions:
  # masked_autoregressive_bernstein_flow:
  #   distribution_kwds: *distribution_kwds
  #   freeze_base_model: true
  #   base_checkpoint_path: unconditional_bernstein_flow
  #   parameter_kwds:
  #     hidden_units:
  #     - 16
  #     - 16
  #     activation: relu
  #   base_distribution: bernstein_flow
  #   base_distribution_kwds: *distribution_kwds
  #   base_parameter_kwds:
  #     conditional: false
  #     dtype: float32
  #   fit_kwds:
  #     epochs: 10000
  #     validation_split: 0.1
  #     batch_size: 512
  #     learning_rate: 0.01
  #     lr_patience: 500
  #     reduce_lr_on_plateau: true
  #     early_stopping: true
  #     verbose: true
  #     monitor: val_loss

  coupling_bernstein_flow:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        coupling_layers: 1
        order: 80
        low: 0
        high: 1
      freeze_base_model: true
      base_checkpoint_path: unconditional_bernstein_flow
      parameter_kwds:
        hidden_units:
        - 512
        - 512
        activation: relu
        batch_norm: false
      base_distribution: bernstein_flow
      base_distribution_kwds: *distribution_kwds
      base_parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 512
        learning_rate: 0.01
        lr_patience: 1000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        coupling_layers: 1
        order: 80
        low: 0
        high: 1
      freeze_base_model: true
      base_checkpoint_path: unconditional_bernstein_flow
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        - 16
        activation: relu
        batch_norm: false
      base_distribution: bernstein_flow
      base_distribution_kwds:
        <<: *distribution_kwds
        order: 80
      base_parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        epochs: 10000
        validation_split: 0.1
        batch_size: 1024
        learning_rate: 0.005
        lr_patience: 1000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss

malnutrition_distributions:
  bernstein_flow:
    distribution_kwds: *distribution_kwds
    parameter_kwds:
      conditional: true
      activation: relu
      batch_norm: true
      hidden_units:
      - 16
      - 16
      input_shape: 1
    fit_kwds:
      epochs: 10000
      validation_split: 0.1
      batch_size: 512
      learning_rate: 0.01
      lr_patience: 50
      reduce_lr_on_plateau: true
      early_stopping: true
      verbose: true
      monitor: val_loss

  multivariate_bernstein_flow:
    distribution_kwds: *distribution_kwds
    parameter_kwds:
      conditional: true
      activation: relu
      batch_norm: true
      hidden_units:
      - 16
      - 16
      input_shape: 1
    fit_kwds:
      epochs: 10000
      validation_split: 0.1
      batch_size: 512
      learning_rate: 0.01
      lr_patience: 50
      reduce_lr_on_plateau: true
      early_stopping: true
      verbose: true
      monitor: val_loss

  multivariate_normal:
    distribution_kwds: {}
    parameter_kwds:
      conditional: true
      activation: relu
      batch_norm: true
      hidden_units:
      - 16
      - 16
      input_shape: 1
    fit_kwds:
      epochs: 10000
      validation_split: 0.1
      batch_size: 512
      learning_rate: 0.01
      lr_patience: 50
      reduce_lr_on_plateau: true
      early_stopping: true
      verbose: true
      monitor: val_loss

  masked_autoregressive_bernstein_flow:
    distribution_kwds: *distribution_kwds
    parameter_kwds:
      hidden_units:
      - 16
      - 16
      activation: relu
      conditional: True,
      # conditional_input_layers='first_layer',
      conditional_event_shape: 1
    fit_kwds:
      epochs: 10000
      validation_split: 0.1
      batch_size: 512
      learning_rate: 0.001
      lr_patience: 50
      reduce_lr_on_plateau: true
      early_stopping: true
      verbose: true
      monitor: val_loss

malnutrition_kwds:
  data_path: datasets/malnutrition/india.raw
  targets: [stunting, wasting, underweight]
  covariates: [mage]
