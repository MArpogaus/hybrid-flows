log-level: info
seed: 1
textwidth: 487.8225
testmode: true

datasets:
  moons:
    n_samples: 2000
    noise: 0.05
    scale: true
  circles:
    n_samples: 2000
    noise: 0.05
    factor: 0.5
    scale: true

benchmark_datasets:
  bsds300: {}
  hepmass: {}
  miniboone: {}
  power: {}

common:
  fit_kwds: &fit_kwds
    epochs: 10000
    validation_split: 0.1
    batch_size: 1024
    lr_patience: 100
    reduce_lr_on_plateau: true
    early_stopping: true
    verbose: true
    monitor: val_loss
  distribution_kwds: &distribution_kwds
    bijector_name: bernstein_poly
    order: 50
    low: -3
    high: 3
    smooth_bounds: true
    allow_flexible_bounds: true
    shift: false
    scale: false
    # bijector_name: quadratic_spline
    # nbins: 32
    # interval_width: 1
    # range_min: 0
    # min_bin_width: 1e-3
    # min_slope: 1e-3

unconditional_distributions:
  elementwise_flow:
    moons:
      distribution_kwds: *distribution_kwds
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        batch_size: 1024
        learning_rate: 0.05
        lr_patience: 100
        lr_reduction_factor: 0.1
        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        order: 80
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        batch_size: 512
        learning_rate: 0.005
        lr_patience: 100
        lr_reduction_factor: 0.1

        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
  multivariate_flow:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        batch_size: 512
        learning_rate: 0.005
        lr_patience: 100
        lr_reduction_factor: 0.1
        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        batch_size: 1024
        learning_rate: 0.005
        lr_patience: 100
        lr_reduction_factor: 0.1

        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
  multivariate_normal:
    moons:
      distribution_kwds: {}
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        batch_size: 512
        learning_rate: 0.05
        lr_patience: 100
        lr_reduction_factor: 0.1
        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds: {}
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        batch_size: 512
        learning_rate: 0.05
        lr_patience: 100
        lr_reduction_factor: 0.1

        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
  masked_autoregressive_flow:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        - 16
        activation: relu
      fit_kwds:
        <<: *fit_kwds
        batch_size: 1024
        learning_rate: 0.05
        lr_patience: 100
        lr_reduction_factor: 0.1
        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        activation: relu
      fit_kwds:
        <<: *fit_kwds
        batch_size: 1024
        learning_rate: 0.01
        lr_patience: 100
        lr_reduction_factor: 0.1

        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
  coupling_flow:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        coupling_layers: 2
        order: 50
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        activation: relu
        batch_norm: false
      fit_kwds:
        <<: *fit_kwds
        batch_size: 512
        learning_rate: 0.001
        lr_patience: 100
        lr_reduction_factor: 0.1
        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        coupling_layers: 2
        order: 50
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        activation: relu
        batch_norm: false
      fit_kwds:
        <<: *fit_kwds
        batch_size: 512
        learning_rate: 0.001
        lr_patience: 100
        lr_reduction_factor: 0.1

        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
unconditional_benchmark_distributions:
  elementwise_flow:
    power:
      distribution_kwds:
        <<: *distribution_kwds
        order: 100
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        validation_split:
        batch_size: 32
        learning_rate: 0.01
        lr_patience: 10
        lr_reduction_factor: 0.1
        epochs: 10000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    hepmass:
      distribution_kwds:
        <<: *distribution_kwds
        order: 100
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        validation_split:
        batch_size: 32
        learning_rate: 0.01
        lr_patience: 10
        lr_reduction_factor: 0.1
        epochs: 10000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    miniboone:
      distribution_kwds:
        <<: *distribution_kwds
        order: 100
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        validation_split:
        batch_size: 373
        learning_rate: 0.004919703071742458
        lr_patience: 7
        lr_reduction_factor: 0.1
        epochs: 10000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    bsds300:
      distribution_kwds:
        <<: *distribution_kwds
        order: 100
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        validation_split:
        batch_size: 32
        learning_rate: 0.01
        lr_patience: 10
        lr_reduction_factor: 0.1

        epochs: 10000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
  masked_autoregressive_flow:
    power:
      fit_kwds:
        batch_size: 128
        early_stopping: true
        epochs: 10000
        learning_rate: 0.01
        lr_patience: 10
        monitor: val_loss
        reduce_lr_on_plateau: true
        verbose: 2
      distribution: masked_autoregressive_bernstein_flow
      distribution_kwds:
        allow_flexible_bounds: false
        base_distribution_kwds:
          concentration0: 5
          concentration1: 2
          distribution_type: kumaraswamy
        high: 0.999
        low: 0.001
        order: 100
        smooth_bounds: true
      parameter_kwds:
        activation: elu
        hidden_units:
        - 256
        - 256
        - 256
        kernel_initializer: he_normal
    hepmass:
      fit_kwds:
        batch_size: 410
        early_stopping: true
        epochs: 10000
        learning_rate: 0.00789718960760212
        lr_patience: 7
        monitor: val_loss
        reduce_lr_on_plateau: true
        verbose: 2
      distribution: masked_autoregressive_bernstein_flow
      distribution_kwds:
        allow_flexible_bounds: false
        base_distribution_kwds:
          concentration0: 5
          concentration1: 2
          distribution_type: kumaraswamy
        clip_to_bernstein_domain: false
        high: 0.999
        low: 0.001
        order: 100
        smooth_bounds: true
      parameter_kwds:
        activation: elu
        hidden_units:
        - 748
        - 381
        - 197
        kernel_initializer: he_normal
    bsds300:
      fit_kwds:
        batch_size: 512
        early_stopping: true
        epochs: 10000
        learning_rate: 0.01
        lr_patience: 15
        monitor: val_loss
        reduce_lr_on_plateau: true
        verbose: 2
      distribution: masked_autoregressive_bernstein_flow
      distribution_kwds:
        allow_flexible_bounds: false
        base_distribution_kwds:
          concentration0: 5
          concentration1: 2
          distribution_type: kumaraswamy
        clip_to_bernstein_domain: false
        high: 0.999
        low: 0.001
        order: 100
        smooth_bounds: true
      parameter_kwds:
        activation: relu
        hidden_units:
        - 128
        - 128
        - 128
  distribution_kwds:
    allow_flexible_bounds: false
    base_distribution_kwds:
      concentration0: 5
      concentration1: 2
      distribution_type: kumaraswamy
    clip_to_bernstein_domain: false
    high: 0.999
    low: 0.001
    order: 100
    smooth_bounds: true
  parameter_kwds:
    activation: relu
    hidden_units:
    - 128
    - 128
    - 128
    fit_kwds:
      batch_size: 512
      early_stopping: true
      epochs: 10000
      learning_rate: 0.01
      lr_patience: 15
      monitor: val_loss
      reduce_lr_on_plateau: true
      verbose: 2
  miniboone:
    fit_kwds:
      batch_size: 32
      early_stopping: true
      epochs: 10000
      learning_rate: 0.01
      lr_patience: 10
      monitor: val_loss
      reduce_lr_on_plateau: true
      verbose: 2
    distribution: masked_autoregressive_bernstein_flow
    distribution_kwds:
      allow_flexible_bounds: true
      clip_to_bernstein_domain: false
      high: 3
      low: -3
      order: 100
      smooth_bounds: true
    parameter_kwds:
      activation: elu
      hidden_units:
      - 64
      - 64
      - 64
      kernel_initializer: he_normal

unconditional_benchmark_hybrid_pre_trained_distributions:
  masked_autoregressive_flow_first_dim_masked:
    power:
      distribution_kwds:
        <<: *distribution_kwds
        order: 80
        low: 0
        high: 1
        bijector_name: bernstein_poly
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      freeze_base_model: true
      base_checkpoint_path: unconditional_benchmark_elementwise_flow
      parameter_kwds:
        made_kwds:
          hidden_units:
          - 512
          - 512
          - 512
          activation: relu
        x0_kwds:
          hidden_units:
          - 64
          - 64
          - 64
          activation: relu
          batch_norm: false
          kernel_initializer: glorot_uniform
          bias_initializer: zeros
      base_distribution: elementwise_flow
      base_distribution_kwds:
        <<: *distribution_kwds
        order: 100
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      base_parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        validation_split:
        batch_size: 128
        learning_rate: 0.001
        lr_patience: 5
        lr_reduction_factor: 0.8
        epochs: 10000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    hepmass:
      distribution_kwds:
        <<: *distribution_kwds
        order: 80
        low: 0
        high: 1
        bijector_name: bernstein_poly
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      freeze_base_model: true
      base_checkpoint_path: unconditional_benchmark_elementwise_flow
      parameter_kwds:
        made_kwds:
          hidden_units:
          - 512
          - 512
          - 512
          activation: relu
        x0_kwds:
          hidden_units:
          - 64
          - 64
          - 64
          activation: relu
          batch_norm: false
          kernel_initializer: glorot_uniform
          bias_initializer: zeros
      base_distribution: elementwise_flow
      base_distribution_kwds:
        <<: *distribution_kwds
        order: 100
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      base_parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        validation_split:
        batch_size: 128
        learning_rate: 0.001
        lr_patience: 5
        lr_reduction_factor: 0.8
        epochs: 10000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    bsds300:
      distribution_kwds:
        <<: *distribution_kwds
        order: 80
        low: 0
        high: 1
        bijector_name: bernstein_poly
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      freeze_base_model: true
      base_checkpoint_path: unconditional_benchmark_elementwise_flow
      parameter_kwds:
        made_kwds:
          hidden_units:
          - 512
          - 512
          - 512
          activation: relu
        x0_kwds:
          hidden_units:
          - 64
          - 64
          - 64
          activation: relu
          batch_norm: false
          kernel_initializer: glorot_uniform
          bias_initializer: zeros
      base_distribution: elementwise_flow
      base_distribution_kwds:
        <<: *distribution_kwds
        order: 100
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      base_parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        validation_split:
        batch_size: 128
        learning_rate: 0.01
        lr_patience: 5
        lr_reduction_factor: 0.8
        epochs: 10000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    miniboone:
      distribution_kwds:
        <<: *distribution_kwds
        order: 80
        low: 0
        high: 1
        bijector_name: bernstein_poly
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      freeze_base_model: true
      base_checkpoint_path: unconditional_benchmark_elementwise_flow
      parameter_kwds:
        made_kwds:
          hidden_units:
          - 512
          - 512
          - 512
          activation: relu
        x0_kwds:
          hidden_units:
          - 64
          - 64
          - 64
          activation: relu
          batch_norm: false
          kernel_initializer: glorot_uniform
          bias_initializer: zeros
      base_distribution: elementwise_flow
      base_distribution_kwds:
        <<: *distribution_kwds
        order: 100
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      base_parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        validation_split:
        batch_size: 128
        learning_rate: 0.001
        lr_patience: 5
        lr_reduction_factor: 0.8


        epochs: 10000
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
conditional_distributions:
  elementwise_flow:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      parameter_kwds:
        conditional: true
        activation: relu
        batch_norm: true
        hidden_units:
        - 16
        - 16
        input_shape: 1
      fit_kwds:
        <<: *fit_kwds
        batch_size: 1024
        learning_rate: 0.01
        lr_patience: 100
        lr_reduction_factor: 0.1
        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      parameter_kwds:
        conditional: true
        activation: relu
        batch_norm: true
        hidden_units:
        - 16
        - 16
        input_shape: 1
      fit_kwds:
        <<: *fit_kwds
        batch_size: 512
        learning_rate: 0.05
        lr_patience: 100
        lr_reduction_factor: 0.1

        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
  multivariate_flow:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      parameter_kwds:
        conditional: true
        activation: relu
        batch_norm: true
        hidden_units:
        - 16
        - 16
        input_shape: 1
      fit_kwds:
        <<: *fit_kwds
        batch_size: 1024
        learning_rate: 0.01
        lr_patience: 100
        lr_reduction_factor: 0.1
        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      parameter_kwds:
        conditional: true
        activation: relu
        batch_norm: true
        hidden_units:
        - 16
        - 16
        input_shape: 1
      fit_kwds:
        <<: *fit_kwds
        batch_size: 1024
        learning_rate: 0.005
        lr_patience: 100
        lr_reduction_factor: 0.1

        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
  multivariate_normal:
    moons:
      distribution_kwds: {}
      parameter_kwds:
        conditional: true
        activation: relu
        batch_norm: true
        hidden_units:
        - 16
        - 16
        input_shape: 1
      fit_kwds:
        <<: *fit_kwds
        batch_size: 512
        learning_rate: 0.05
        lr_patience: 100
        lr_reduction_factor: 0.1
        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds: {}
      parameter_kwds:
        conditional: true
        activation: relu
        batch_norm: true
        hidden_units:
        - 16
        - 16
        input_shape: 1
      fit_kwds:
        <<: *fit_kwds
        batch_size: 1024
        learning_rate: 0.05
        lr_patience: 100
        lr_reduction_factor: 0.1

        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
  masked_autoregressive_flow:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        - 16
        activation: relu
        conditional: True,
        # conditional_input_layers='first_layer',
        conditional_event_shape: 1
      fit_kwds:
        <<: *fit_kwds
        batch_size: 1024
        learning_rate: 0.01
        lr_patience: 100
        lr_reduction_factor: 0.1
        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        order: 50
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        - 16
        activation: relu
        conditional: True,
        # conditional_input_layers='first_layer',
        conditional_event_shape: 1
      fit_kwds:
        <<: *fit_kwds
        batch_size: 1024
        learning_rate: 0.05
        lr_patience: 100
        lr_reduction_factor: 0.1

        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
  coupling_flow:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        coupling_layers: 2
        order: 80
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        - 16
        activation: relu
        batch_norm: false,
        conditional: True,
        conditional_event_shape: 1
      fit_kwds:
        <<: *fit_kwds
        batch_size: 1024
        learning_rate: 0.01
        lr_patience: 100
        lr_reduction_factor: 0.1
        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        coupling_layers: 2
        order: 50
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        activation: relu
        batch_norm: false,
        conditional: True,
        conditional_event_shape: 1
      fit_kwds:
        <<: *fit_kwds
        batch_size: 512
        learning_rate: 0.01
        lr_patience: 100
        lr_reduction_factor: 0.1

        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
unconditional_hybrid_distributions:
  masked_autoregressive_flow_first_dim_masked:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        order: 100
        low: 0
        high: 1
        bijector_name: bernstein_poly
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      freeze_base_model: false
      base_checkpoint_path: false
      parameter_kwds:
        made_kwds:
          hidden_units: []
          activation: relu
        x0_kwds:
          hidden_units:
          - 16
          - 16
          activation: relu
          batch_norm: false
          kernel_initializer: glorot_uniform
          bias_initializer: zeros
      base_distribution: elementwise_flow
      base_distribution_kwds: *distribution_kwds
      base_parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        batch_size: 512
        learning_rate: 0.01
        lr_patience: 500
        lr_reduction_factor: 0.1
        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        order: 100
        low: 0
        high: 1
        bijector_name: bernstein_poly
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      freeze_base_model: false
      base_checkpoint_path: false
      parameter_kwds:
        made_kwds:
          hidden_units: []
          activation: relu
        x0_kwds:
          hidden_units:
          - 16
          - 16
          activation: relu
          batch_norm: false
          kernel_initializer: glorot_uniform
          bias_initializer: zeros
      base_distribution: elementwise_flow
      base_distribution_kwds: *distribution_kwds
      base_parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        batch_size: 512
        learning_rate: 0.01
        lr_patience: 500
        lr_reduction_factor: 0.1

        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
  coupling_flow:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        coupling_layers: 1
        order: 80
        low: 0
        high: 1
        bijector_name: bernstein_poly
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      freeze_base_model: false
      base_checkpoint_path: false
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        activation: relu
        batch_norm: false
      base_distribution: elementwise_flow
      base_distribution_kwds: *distribution_kwds
      base_parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        batch_size: 512
        learning_rate: 0.05
        lr_patience: 100
        lr_reduction_factor: 0.1
        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        coupling_layers: 1
        order: 80
        low: 0
        high: 1
        bijector_name: bernstein_poly
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      freeze_base_model: false
      base_checkpoint_path: false
      parameter_kwds:
        hidden_units:
        - 512
        - 512
        activation: relu
        batch_norm: false
      base_distribution: elementwise_flow
      base_distribution_kwds: *distribution_kwds
      base_parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        batch_size: 1024
        learning_rate: 0.005
        lr_patience: 100
        lr_reduction_factor: 0.1

        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
unconditional_hybrid_pre_trained_distributions:
  # masked_autoregressive_flow:
  #   distribution_kwds: *distribution_kwds
  #   freeze_base_model: true
  #   base_checkpoint_path: unconditional_flow
  #   parameter_kwds:
  #     hidden_units:
  #     - 16
  #     - 16
  #     activation: relu
  #   base_distribution: elementwise_flow
  #   base_distribution_kwds: *distribution_kwds
  #   base_parameter_kwds:
  #     conditional: false
  #     dtype: float32
  #   fit_kwds:
  #     epochs: 10000
  #     validation_split: 0.1
  #     batch_size: 512
  #     learning_rate: 0.01
  #     lr_patience: 500
  #     reduce_lr_on_plateau: true
  #     early_stopping: true
  #     verbose: true
  #     monitor: val_loss

  coupling_flow:
    moons:
      distribution_kwds:
        <<: *distribution_kwds
        coupling_layers: 1
        order: 80
        low: 0
        high: 1
        bijector_name: bernstein_poly
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      freeze_base_model: true
      base_checkpoint_path: unconditional_elementwise_flow
      parameter_kwds:
        hidden_units:
        - 512
        - 512
        activation: relu
        batch_norm: false
      base_distribution: elementwise_flow
      base_distribution_kwds: *distribution_kwds
      base_parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        batch_size: 512
        learning_rate: 0.01
        lr_patience: 100
        lr_reduction_factor: 0.1
        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
    circles:
      distribution_kwds:
        <<: *distribution_kwds
        coupling_layers: 1
        order: 80
        low: 0
        high: 1
        bijector_name: bernstein_poly
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      freeze_base_model: true
      base_checkpoint_path: unconditional_elementwise_flow
      parameter_kwds:
        hidden_units:
        - 16
        - 16
        - 16
        activation: relu
        batch_norm: false
      base_distribution: elementwise_flow
      base_distribution_kwds:
        <<: *distribution_kwds
        order: 80
        bijector_name: bernstein_poly
        low: -3
        high: 3
        smooth_bounds: true
        allow_flexible_bounds: true
        shift: false
        scale: false
      base_parameter_kwds:
        conditional: false
        dtype: float32
      fit_kwds:
        <<: *fit_kwds
        batch_size: 1024
        learning_rate: 0.005
        lr_patience: 100
        lr_reduction_factor: 0.1

        epochs: 10000
        validation_split: 0.1
        reduce_lr_on_plateau: true
        early_stopping: true
        verbose: true
        monitor: val_loss
malnutrition_distributions:
  elementwise_flow:
    distribution_kwds: *distribution_kwds
    parameter_kwds:
      conditional: true
      activation: relu
      batch_norm: true
      hidden_units:
      - 16
      - 16
      input_shape: 1
    fit_kwds:
      <<: *fit_kwds
      batch_size: 512
      learning_rate: 0.01
      lr_patience: 50
      lr_reduction_factor: 0.1

      epochs: 10000
      validation_split: 0.1
      reduce_lr_on_plateau: true
      early_stopping: true
      verbose: true
      monitor: val_loss
  multivariate_flow:
    distribution_kwds: *distribution_kwds
    parameter_kwds:
      conditional: true
      activation: relu
      batch_norm: true
      hidden_units:
      - 16
      - 16
      input_shape: 1
    fit_kwds:
      <<: *fit_kwds
      batch_size: 512
      learning_rate: 0.01
      lr_patience: 50
      lr_reduction_factor: 0.1

      epochs: 10000
      validation_split: 0.1
      reduce_lr_on_plateau: true
      early_stopping: true
      verbose: true
      monitor: val_loss
  multivariate_normal:
    distribution_kwds: {}
    parameter_kwds:
      conditional: true
      activation: relu
      batch_norm: true
      hidden_units:
      - 16
      - 16
      input_shape: 1
    fit_kwds:
      <<: *fit_kwds
      batch_size: 512
      learning_rate: 0.01
      lr_patience: 50
      lr_reduction_factor: 0.1

      epochs: 10000
      validation_split: 0.1
      reduce_lr_on_plateau: true
      early_stopping: true
      verbose: true
      monitor: val_loss
  masked_autoregressive_flow:
    distribution_kwds: *distribution_kwds
    parameter_kwds:
      hidden_units:
      - 16
      - 16
      activation: relu
      conditional: True,
      # conditional_input_layers='first_layer',
      conditional_event_shape: 1
    fit_kwds:
      <<: *fit_kwds
      batch_size: 512
      learning_rate: 0.001
      lr_patience: 50
      lr_reduction_factor: 0.1

      epochs: 10000
      validation_split: 0.1
      reduce_lr_on_plateau: true
      early_stopping: true
      verbose: true
      monitor: val_loss
malnutrition_kwds:
  data_path: datasets/malnutrition/india.raw
  targets:
  - stunting
  - wasting
  - underweight
  covariates:
  - mage
